import numpy as np
import pytest
from bokeh.io import show
from bokeh.plotting import figure

from binara import internal_calculate_light_curve


@pytest.mark.skip
def test_calculate_light_curve():
    # Parameters and sample light curve taken from a run of Gioula Kalapotharakos for TIC ID 110602878 sector 34.
    model_parameters = np.array([
        0.385886490907, 0.0664402461459, 0.728154, 0.398693367346, 0.0250731943869, -2.58470776396, 0.986066718147,
        -0.0495279552116, -1.02057860777, 0.368375172834, 0.275439743308, 0.0288241638398, 0.374759311771,
        0.922036025043, 1.61396897845, 0.113311357046, 0.242166052741, -1.42801281267, 1.40666171312, 0.650303472667,
        0.999811553496
    ], dtype=np.float64)
    model_phases = np.array([
        0.0178251167, 0.0534753500, 0.0891255833, 0.1247758167, 0.1604260500, 0.1960762833, 0.2317265167, 0.2673767500,
        0.3030269833, 0.3386772167, 0.3743274500, 0.4099776833, 0.4456279167, 0.4812781500, 0.5169283833, 0.5525786167,
        0.5882288500, 0.6238790833, 0.6595293167, 0.6951795500, 0.7308297833, 0.7664800167, 0.8021302500, 0.8377804833,
        0.8734307167, 0.9090809500, 0.9447311833, 0.9803814167, 1.0160316500, 1.0516818833, 1.0873321167, 1.1229823500,
        1.1586325833, 1.1942828167, 1.2299330500, 1.2655832833, 1.3012335167, 1.3368837500, 1.3725339833, 1.4081842167,
        1.4438344500, 1.4794846833, 1.5151349167, 1.5507851500, 1.5864353833, 1.6220856167, 1.6577358500, 1.6933860833,
        1.7290363167, 1.7646865500, 1.8003367833, 1.8359870167, 1.8716372500, 1.9072874833, 1.9429377167, 1.9785879500,
        2.0142381833, 2.0498884167, 2.0855386500, 2.1211888833, 2.1568391167, 2.1924893500, 2.2281395833, 2.2637898167,
        2.2994400500, 2.3350902833, 2.3707405167, 2.4063907500, 2.4420409833, 2.4776912167, 2.5133414500, 2.5489916833,
        2.5846419167, 2.6202921500, 2.6559423833, 2.6915926167, 2.7272428500, 2.7628930833, 2.7985433167, 2.8341935500,
        2.8698437833, 2.9054940167, 2.9411442500, 2.9767944833, 3.0124447167, 3.0480949500, 3.0837451833, 3.1193954167,
        3.1550456500, 3.1906958833, 3.2263461167, 3.2619963500, 3.2976465833, 3.3332968167, 3.3689470500, 3.4045972833,
        3.4402475167, 3.4758977500, 3.5115479833, 3.5471982167, 3.5828484500, 3.6184986833, 3.6541489167, 3.6897991500,
        3.7254493833, 3.7610996167, 3.7967498500, 3.8324000833, 3.8680503167, 3.9037005500, 3.9393507833, 3.9750010167,
        4.0106512500, 4.0463014833, 4.0819517167, 4.1176019500, 4.1532521833, 4.1889024167, 4.2245526500, 4.2602028833,
        4.2958531167, 4.3315033500, 4.3671535833, 4.4028038167, 4.4384540500, 4.4741042833, 4.5097545167, 4.5454047500,
        4.5810549833, 4.6167052167, 4.6523554500, 4.6880056833, 4.7236559167, 4.7593061500, 4.7949563833, 4.8306066167,
        4.8662568500, 4.9019070833, 4.9375573167, 4.9732075500, 5.0088577833, 5.0445080167, 5.0801582500, 5.1158084833,
        5.1514587167, 5.1871089500, 5.2227591833, 5.2584094167, 5.2940596500, 5.3297098833], dtype=np.float64)
    expected_model_fluxes = np.array([
        1.0000579014, 1.0000937983, 1.0001351833, 1.0001830919, 1.0002387182, 1.0003034146, 1.0003786745, 1.0004660902,
        1.0005672745, 1.0006837324, 1.0008166693, 1.0009667272, 1.0011336464, 1.0013158759, 1.0015101815, 1.0017113437,
        1.0019120739, 1.0021032947, 1.0022748954, 1.0024169623, 1.0025213106, 1.0025829563, 1.0026010770, 1.0025791017,
        1.0025238542, 1.0024440251, 1.0023484778, 1.0022448880, 1.0021389972, 1.0020344863, 1.0019332812, 0.9995152564,
        0.9872870908, 0.9825786577, 0.9824916137, 0.9848125742, 0.9972384355, 1.0013177134, 1.0012387158, 1.0011615144,
        1.0010862075, 1.0010129313, 1.0009418349, 1.0008730615, 1.0008067361, 1.0007429573, 1.0006817948, 1.0006232883,
        1.0005674496, 1.0005142651, 1.0004636993, 1.0004156985, 1.0003701948, 1.0003271088, 1.0002863528, 1.0002478338,
        1.0002114553, 1.0001771192, 1.0001447274, 1.0001141827, 1.0000853904, 1.0000582580, 1.0000326965, 1.0000086206,
        0.9999859486, 0.9999646028, 0.9999445095, 0.9999255990, 0.9999078053, 0.9998910666, 0.9998753243, 0.9998605237,
        0.9998466132, 0.9998335447, 0.9998212728, 0.9998097553, 0.9997989525, 0.9997888274, 0.9997793454, 0.9997704741,
        0.9997621832, 0.9997544445, 0.9997472317, 0.9997405201, 0.9997342866, 0.9997285100, 0.9997231701, 0.9997182483,
        0.9997137273, 0.9997095907, 0.9997058236, 0.9997024118, 0.9996993423, 0.9996966029, 0.9996941824, 0.9996920702,
        0.9996902567, 0.9996887328, 0.9996874903, 0.9996865216, 0.9996858196, 0.9996853778, 0.9996851903, 0.9996852518,
        0.9996855575, 0.9996861028, 0.9996868839, 0.9996878973, 0.9996891400, 0.9996906093, 0.9996923031, 0.9996942195,
        0.9996963571, 0.9996987151, 0.9997012926, 0.9997040897, 0.9997071066, 0.9997103439, 0.9997138028, 0.9997174851,
        0.9997213930, 0.9997255293, 0.9997298975, 0.9997345020, 0.9997393480, 0.9997444414, 0.9997497899, 0.9997554019,
        0.9997612880, 0.9997674603, 0.9997739335, 0.9997807249, 0.9997878552, 0.9997953493, 0.9998032369, 0.9998115535,
        0.9998203422, 0.9934302556, 0.9689839406, 0.9423796188, 0.9365054447, 0.9365176270, 0.9365308114, 0.9427980235,
        0.9695035218, 0.9937965994, 0.9999534436, 0.9999749530, 0.9999991653, 1.0000266040], dtype=np.float64)
    model_fluxes = internal_calculate_light_curve(model_phases, model_parameters)
    assert np.allclose(model_fluxes, expected_model_fluxes)
